{"version":3,"sources":["logo.svg","Utils.js","DataHandling.js","components/FiltersComponent/FiltersComponent.js","VizHelpers.js","components/DeprivationScatterPlot/DeprivationScatterPlot.js","components/DonorBarChart/DonorBarChart.js","components/MapComponent/MapComponent.js","components/BodyComponent/BodyComponent.js","App.js","DataLoading.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","prepKeyValuePairs","list","id","labelFunc","filterBy","unsortedList","map","d","label","filter","_","sortBy","locationLabelFunc","placeName","donorLabelFunc","prepAllData","originalData","selectedRegion","selectedGeoLevel","selectedComparison","filters","filterMin","console","log","grant","comparison","geo","dataForMap","dataForScatter","dataForSmallMultiples","comparisonVars","untouchedVars","Object","objectWithoutProperties","allComparisonTypes","keys","data","forEach","filterOn","filterLocation","filterDonor","_filterDiscrete","filterDiscrete","grantFiltered","comparisonFiltered","c","dataset","columns","startsWith","value","s","slice","split","join","word","toUpperCase","year","flatten","sourceName","prepScatterData","prepSmallMultiplesData","objectSpread","yVal","yMin","scatterRight","nest","key","rollup","values","dataFieldName","dataField","defineProperty","some","x","sum","entries","scatterLeft","mergeById","lookUp","nested_data","leaves","projects","total_awarded","y","length","filterKeys","grantData","comparisonData","includes","grantLocationKey","yearsRange","range","extent","mainTable","lookupTable","mainKey","lookupKey","keepVarsMain","keepVarsLookup","select","mainItem","lookUpItem","mainKeep","mainValueLocation","lookUpValueLocation","lookUpKeep","pick","l","m","lookupIndex","output","i","row","j","push","FiltersComponent","props","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","react_default","a","createElement","className","Component","defaultProps","getColorScale","scaleQuantile","domain","convertHex","hex","opacity","replace","parseInt","substring","makeTooltip","title","items","htmlBlock","getExtent","minLimit","allPos","paddingPercent","_extent","_extent2","slicedToArray","min","max","padding","DeprivationScatterPlot","_this","createBarChart","bind","assertThisInitialized","_this2","xVal","filterFunc","addFilter","remove","_ref","margin","width","dimensions","height","node","xValues","yValues","_getExtent","yMinLimit","_getExtent2","yMax","_getExtent3","_getExtent4","xMin","xMax","tooltip","tip","attr","offset","direction","html","xValLabel","format","unfiltered","filtered","concat","scaleLinear","scaleLog","colorScale","selectAll","append","zoom","d3zoom","scaleExtent","on","new_xScale","event","transform","rescaleX","new_yScale","rescaleY","new_xScale_to_call","xAxis","scale","new_yScale_to_call","yAxis","gX","gY","points","_new_xScale_to_call$s","_new_xScale_to_call$s2","style","g","enter","show","hide","location","axisBottom","ticks","tickFormat","axisLeft","tickValues","minVal","maxVal","currentPow","returnVals","Math","pow","getPowersOf10","text","_this3","ref","DonorBarChart","amount","dataForChart","scaleBand","bandwidth","mapboxgl","accessToken","MapComponent","setStateForMe","state","setState","callBackFuncClick","callBackFuncMMove","callBackFuncMLeave","popup","Popup","closeButton","anchor","mainLayerId","sources","geoId","_this$state","Map","container","mapContainer","center","mapFormatting","position","_this2$props","mapData","scatterPlotData","mapGeoId","mapGeoPlaceName","allMapSources","expression","buildDataLayer","addSource","filePath","type","sourceLayer","addDataLayer","setUpMouseOver","setUpOnClick","myMap","off","e","placeCode","features","properties","hoveredStateId","setFeatureState","source","hover","objectid","tooltipTitle","scatterDataPoint","tooltipVars","setLngLat","lngLat","setHTML","addTo","color","svg","legend","legendColor","labelFormat","titleWidth","metadata","mapSources","layerMetaDataForFill","paint","fill-color","fill-outline-color","url","addLayer","uniq","toConsumableArray","layerMetaDataForHighlight","line-color","line-width","removeLayer","removedSourcesIndex","sourceCaches","removeSource","nextProps","_this4","waiting","isStyleLoaded","getLayer","removeDataLayer","setTimeout","_this5","el","YearSlider","createSliderWithTooltip","Slider","Range","Card","content","react_markdown_default","BodyComponent","locationValueRenderer","selected","options","donorValueRenderer","toggleSelector","selector","showSelectorLocations","showSelectorDonors","filterLocations","selectedLocations","locationsList","filterDonors","selectedDonors","donorsList","donor","setNewLocationsList","setNewDonorsList","smallMultiplesData","newList","mapAndScatterWidth","lib","fluid","xs","onClick","reactjs_popup_es","trigger","BodyComponent_Card","infoBoxes","react_multi_select_default","selectedItems","onChange","allowCross","defaultValue","onAfterChange","years","dots","pushable","components_MapComponent_MapComponent","scatterPlotXVal","scatterPlotXValLabel","components_DeprivationScatterPlot_DeprivationScatterPlot","notZero","components_DonorBarChart_DonorBarChart","App","toggle","newFilterObj","k","consolidatedFilters","mutatedData","layerControls","window","innerWidth","innerHeight","updateDimensions","addEventListener","getData","initialCall","rawData","Promise","all","then","processedData","size","currentData","sheetsy","urlToKey","getWorkbook","getSheet","files","name","lookupFilePath","LAD","ward","csvPath","abbreviations","geoLevel","region","eng","sco","nir","wal","uk","regions","geoLevels","promises","f","csv","json","result","_loop","_files$i$name$split","_files$i$name$split2","toArray","category","country","otherParts","datasetName","keyBy","valueRegion","keyRegion","valueLevel","keyLevel","loadAllData","prepAndloadDataToState","getComparisonVarLabel","isLoading","isEmpty","regionPicker","react_select_esm","selectedOption","geoPicker","comparisonPicker","components_BodyComponent_BodyComponent","Boolean","hostname","match","ReactDOM","render","src_App_0","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.d72e0556.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","import _ from 'lodash';\n\nexport const capitalize = (s) => {\n  return s && s.split(' ').map(word => word[0].toUpperCase() + word.slice(1)).join(' ');\n}\n\nexport const prepKeyValuePairs = (list,id,labelFunc,filterBy) => {\n  const unsortedList = list.map(d => {\n    return {\n      label: labelFunc(d),\n      id: d[id],\n      filter: d[filterBy]\n    }\n  })\n\n  return _.sortBy(unsortedList, ['label']);\n}\n\nexport const locationLabelFunc = (d) => {\n  return d.placeName + \" [\" + d.id + \"]\"\n}\n\nexport const donorLabelFunc = (d) => {\n  return d['key']\n}","import { nest } from 'd3-collection';\nimport { sum } from 'd3-array';\nimport { extent } from 'd3-array'\nimport _ from 'lodash';\nimport { capitalize } from './Utils';\n\nconst grants_defult_dataset_name = 'LAD_ward_donor_year';\n\nexport const prepAllData = (originalData, selectedRegion, \n  selectedGeoLevel, selectedComparison, filters,filterMin) => {\n\n  console.log(originalData);\n  console.log(selectedRegion, selectedGeoLevel, selectedComparison);\n\n  let {grant, comparison, geo, \n    dataForMap, dataForScatter, dataForSmallMultiples, \n    comparisonVars,\n    ...untouchedVars} = originalData;\n\n  // console.log(untouchedVars);\n  const allComparisonTypes = Object.keys(comparison[selectedRegion][selectedGeoLevel]);\n\n  // test\n  // filters = {'location': ['E09000028','E09000001'], 'years': [2013,2016]};\n\n  console.log(\"filters: \",filters);\n  console.log(grant);\n  grant[selectedRegion][grants_defult_dataset_name].data.forEach(d => {\n    // d.filterOn = Math.random() > 0.5 ? true : false;\n    d.filterOn = true;\n    d.filterLocation = true;\n    d.filterDonor = true;\n  })\n  comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data.forEach(d => {\n    // d.filterOn = Math.random() > 0.5 ? true : false;\n    d.filterOn = true;\n    d.filterLocation = true;\n  })\n\n  // filter functions \n  if (filters) {\n    // {grantFiltered: grantData, comparisonFiltered: comparisonData}\n    let {grantFiltered, comparisonFiltered} = filterDiscrete(\n      filters,\n      grant[selectedRegion][grants_defult_dataset_name],\n      comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]],\n      selectedRegion, \n      selectedGeoLevel, \n      selectedComparison\n    )\n\n    grant[selectedRegion][grants_defult_dataset_name].data = grantFiltered;\n    comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data = comparisonFiltered;\n  }\n\n  // console.log(grant);\n\n  comparisonVars = allComparisonTypes\n    .map(c => {\n      const dataset = comparison[selectedRegion][selectedGeoLevel][c];\n      // console.log(dataset);\n      return dataset.data.columns\n        .filter(d => d.startsWith(\"comparison_\"))\n        .map(d => {\n          return {\n            value: [c, d], \n            label: capitalize((c + ' - ' + d.slice(11)).split('_').join(' ')) + \" (\" + dataset.year + \")\"\n          }\n        });\n    })\n\n  comparisonVars = _.flatten(comparisonVars);\n  \n  // [selectedComparison[0]]\n\n  // prep filtered data for charts\n  dataForMap = geo[selectedRegion][selectedGeoLevel].sourceName;\n  dataForScatter = prepScatterData(originalData, selectedRegion, \n    selectedGeoLevel, selectedComparison,'Amount Awarded',filterMin);\n  dataForSmallMultiples = prepSmallMultiplesData(originalData, selectedRegion);\n\n  \n  // console.log(dataForSmallMultiples);\n\n  // return object with data prepared for each chart\n  return {\n    grant, comparison, geo,\n    comparisonVars: comparisonVars,\n    dataForMap: dataForMap, \n    dataForScatter: dataForScatter, \n    dataForSmallMultiples: dataForSmallMultiples,\n    ...untouchedVars\n  }\n}\n\nexport const prepScatterData = (originalData, selectedRegion, \n  selectedGeoLevel, selectedComparison,yVal,yMin) => {\n\n  console.log(originalData);\n\n  // right hand side dataset (Y-Axis)\n  const scatterRight = nest()\n    .key(d => d[originalData.grant[selectedRegion][grants_defult_dataset_name].id[selectedGeoLevel]])\n    .rollup(values => {\n      const dataFieldName = originalData.grant[selectedRegion][grants_defult_dataset_name].dataField;\n      return ({\n        filterOn: values.some(x => x.filterOn === true) === true,\n        filterLocation: values.some(x => x.filterLocation === true) === true,\n        filterDonor: values.some(x => x.filterDonor === true) === true,\n        [dataFieldName]: sum(values, d => {\n          let returnVal = (d.filterOn && d.filterDonor)\n            ? +d[dataFieldName]\n            : 0;\n          return returnVal;\n        }) \n      })\n    }\n      \n    )\n    .entries(originalData.grant[selectedRegion][grants_defult_dataset_name].data);\n\n  // console.log(scatterLeft,scatterRight);\n\n  // left hand side dataset (X-Axis) \n  const scatterLeft = nest()\n    .key(d => d[originalData.comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].id])\n    .entries(originalData.comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data);\n\n\n\n  // merge left hand side dataset and right hand side dataset\n  let mergedLeftRight = mergeById(scatterLeft,scatterRight,'key','key',\n    [selectedComparison[1]],\n    [originalData.grant[selectedRegion][grants_defult_dataset_name].dataField]\n  );\n\n  // mergedLeftRight = mergedLeftRight.filter(d => +d[yVal]>=yMin)\n  // console.log(mergedLeftRight);\n\n  // Get place names\n  return mergedLeftRight.map(d => {\n    // console.log(d);\n    const placeName = originalData.geo[selectedRegion][selectedGeoLevel].lookUp[d.id]\n      ? originalData.geo[selectedRegion][selectedGeoLevel].lookUp[d.id].value\n      : '';\n    return {...d, placeName: placeName};\n  });\n}\n\nexport const prepSmallMultiplesData = (originalData, selectedRegion) => {\n  \n  const data = originalData.grant[selectedRegion][grants_defult_dataset_name].data;\n\n  var nested_data = nest()\n  .key(function(d) { return d['Funding Org:Name']; })\n  .key(function(d) { return d['Award Year']; })\n  .rollup(function(leaves) { \n    return {\n      \"projects\": sum(leaves, d => (d['filterOn'] && d['filterLocation']) ? d['Identifier'] : 0), \n      \"total_awarded\": sum(leaves, d => (d['filterOn'] && d['filterLocation']) ? d['Amount Awarded'] : 0),\n      \"filterDonor\": sum(leaves, d => (d['filterOn'] && d['filterLocation'] && d['filterDonor']) ? d['Identifier'] : 0)\n    } \n  })\n  .entries(data);\n\n  // return nested_data.filter(d => d.values.filter(y => y.value[\"total_awarded\"]>0).length > 0);\n  nested_data = nested_data.map(d => { \n    d['filterDonor'] = d.values.filter(y => y.value[\"filterDonor\"]>0).length > 0\n      ? true\n      : false;\n    d['notZero'] = d.values.filter(y => y.value[\"total_awarded\"]>0).length > 0\n      ? true\n      : false;\n    return d;\n  })\n  return nested_data;\n}\n\n// Filterable dimensions:\n// - location\n// - time\n// - donor\nexport const filterDiscrete = (filters,grant,comparison,\n  selectedRegion,selectedGeoLevel,selectedComparison) => {\n  const filterKeys = Object.keys(filters);\n\n\n  let grantData = grant.data;\n  let comparisonData = comparison.data;\n\n  // console.log(filterKeys,filters,grantData,comparisonData);\n  // console.log(\"location\" in filterKeys);\n\n  if (filterKeys.includes('location') && filters['location'] !== 'reset') {\n    const grantLocationKey = grant.id[selectedGeoLevel];\n    grantData.forEach(d => {\n      d.filterLocation = (filters['location'].includes(d[grantLocationKey])) ? true : false;\n    })\n  }\n\n  if (filterKeys.includes('donor') && filters['donor'] !== 'reset') {\n    grantData.forEach(d => {\n      d.filterDonor = (filters['donor'].includes(d['Funding Org:Name'])) ? true : false;\n    })\n  }\n\n  if (filterKeys.includes('years') && filters['years'] !== 'reset') {\n    const yearsRange = _.range(extent(filters['years'])[0],extent(filters['years'])[1]);\n    // console.log(extent(filters['years']));\n    grantData.forEach(d => {\n      d.filterOn = (yearsRange.includes(+d['Award Year'])) ? true : false;\n    })\n  }\n\n  return {grantFiltered: grantData, comparisonFiltered: comparisonData}\n}\n\nexport const filterContinuous = () => {\n\n}\n\nexport const mergeById = (mainTable, lookupTable, \n  mainKey, lookupKey, keepVarsMain, keepVarsLookup) => {\n\n  const select = (mainItem, lookUpItem) => {\n\n    let mainKeep, mainValueLocation, lookUpValueLocation, lookUpKeep, filterOn, filterLocation, filterDonor;\n    mainKeep = mainValueLocation = lookUpValueLocation = lookUpKeep = filterOn = filterLocation = filterDonor = null;\n\n    \n    if(mainItem) {\n      mainValueLocation = mainItem.value ? mainItem.value : mainItem.values[0];\n      mainKeep = _.pick(mainValueLocation, keepVarsMain);\n    }\n\n    if(lookUpItem) {\n      lookUpValueLocation = lookUpItem.value ? lookUpItem.value : lookUpItem.values[0];\n      lookUpKeep = _.pick(lookUpValueLocation, keepVarsLookup);\n    }\n\n\n    if (mainItem && lookUpItem) {\n      filterOn = mainValueLocation.filterOn && lookUpValueLocation.filterOn;\n      filterLocation = mainValueLocation.filterLocation && lookUpValueLocation.filterLocation;\n      filterDonor = mainValueLocation.filterDonor && lookUpValueLocation.filterDonor;\n    }\n    else if (mainItem) {\n      filterOn = mainValueLocation.filterOn;\n      filterLocation = mainValueLocation.filterLocation;\n      filterDonor = mainValueLocation.filterDonor;\n    }\n    else if (lookUpItem) {\n      filterOn = lookUpValueLocation.filterOn;\n      filterLocation = lookUpValueLocation.filterLocation;\n      filterDonor = lookUpValueLocation.filterDonor;\n    }\n\n    return {\n      id: mainItem.key,\n      ...mainKeep,\n      ...lookUpKeep,\n      filterOn: filterOn,\n      filterLocation: filterLocation,\n      filterDonor: filterDonor\n    };\n  }\n\n  // console.log(mainTable,lookupTable);\n\n  let l = lookupTable.length,\n      m = mainTable.length,\n      lookupIndex = [],\n      output = [];\n      \n  for (let i = 0; i < l; i++) { // loop through l items\n    let row = lookupTable[i];\n    lookupIndex[row[lookupKey]] = row; // create an index for lookup table\n  }\n  for (let j = 0; j < m; j++) { // loop through m items\n    let y = mainTable[j];\n    let x = lookupIndex[y[mainKey]]; // get corresponding row from lookupTable\n    output.push(select(y, x)); // select only the columns you need\n  }\n  // console.log(output);\n  return output;\n\n}","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport './FiltersComponent.scss'\n\nclass FiltersComponent extends Component {\n    constructor(props) {\n        super(props)\n    }\n    \n    render() {\n        return (\n            <div className=\"FiltersComponent\"></div>\n        );\n    }\n}\n\nFiltersComponent.propTypes = {}\n\nFiltersComponent.defaultProps = {}\n\nexport default FiltersComponent\n","\nimport {scaleQuantile} from 'd3-scale';\nimport {extent} from 'd3-array';\nimport _ from 'lodash';\n\nexport const getColorScale = (d) => {\n  // console.log(d);\n  return scaleQuantile()\n    .domain(_.range(d[0], d[1], (d[1]-d[0])/10))\n    // .domain([0,5,10,15,20,25,30,35,40])\n    .range(['#f8d5cc','#f4bfb6','#f1a8a5','#ee8f9a','#ec739b','#dd5ca8','#c44cc0','#9f43d7','#6e40e6']);\n}\n\nexport const convertHex = (hex,opacity) => {\n  hex = hex.replace('#','');\n  const r = parseInt(hex.substring(0,2), 16);\n  const g = parseInt(hex.substring(2,4), 16);\n  const b = parseInt(hex.substring(4,6), 16);\n\n  const result = 'rgba('+r+','+g+','+b+','+opacity/100+')';\n  return result;\n}\n\nexport const makeTooltip = (title,items) => {\n  let htmlBlock = \"<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:150px; z-index:2000'>\"\n  htmlBlock += title ? \"<div style='font-size:20px'>\" + title + \"</div>\" : '';\n  if (items)\n    items.forEach(i => {\n      htmlBlock += (\"<br/><strong>\"+i.label+\":</strong> \")\n      htmlBlock += (\"<br/><div class='tootltip-value' style='font-size:18px;'>\"+i.value+\"</div>\")\n    })\n  htmlBlock += '</div>';\n  return htmlBlock;\n}\n\nexport const getPowersOf10 = (minVal,maxVal) => {\n  // console.log(minVal,maxVal);\n  let currentPow = 0;\n  let returnVals = [];\n  while (Math.pow(10,currentPow) <= maxVal) {\n    if (Math.pow(10,currentPow) >= minVal) \n      returnVals.push(Math.pow(10,currentPow));\n    currentPow++;\n  }\n  return returnVals;\n}\n\nexport const getExtent = (values,minLimit,allPos,paddingPercent) => {\n  let [min,max] = extent(values);\n  \n  const padding = paddingPercent ? (max-min)*paddingPercent : (max-min)*0.1\n  min = min-padding;\n  max = max+padding;\n  \n  if (minLimit) {\n    min = min > minLimit ? min : minLimit;\n    max = max > 0 ? max : min;\n  }\n  if (allPos) {\n    min = min > 0 ? min : 1;\n    max = max > 0 ? max : 1;\n  }\n  // console.log([min,max]);\n  return [min,max]\n} ","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport './DeprivationScatterPlot.scss'\nimport { select, event } from 'd3-selection'\nimport { scaleBand,scaleLinear,scaleLog } from 'd3-scale'\nimport { axisBottom, axisLeft } from 'd3-axis'\nimport { zoom as d3zoom } from 'd3-zoom'\nimport { format } from 'd3-format'\nimport { extent } from 'd3-array'\nimport { getColorScale, convertHex, makeTooltip, getPowersOf10, getExtent } from '../../VizHelpers'\nimport _ from 'lodash'\nimport { default as tip } from 'd3-tip'\n\n\nclass DeprivationScatterPlot extends Component {\n    constructor(props){\n      super(props)\n      this.createBarChart = this.createBarChart.bind(this)\n    }\n\n\n    componentDidMount() {\n      this.createBarChart()\n    }\n    \n    componentDidUpdate() {\n      this.createBarChart()\n    }\n    \n    createBarChart() {\n      const xVal = this.props.xVal;\n      const yVal = 'Amount Awarded';\n\n      let data = this.props.data;\n      const filterFunc = this.props.addFilter;\n      select('.d3-tip').remove();\n\n      const opacity = 100;\n\n      \n\n\n      // console.log(this.props);\n      data = data.map(d => {\n        return {\n          'id': d['id'],\n          [xVal]: d[xVal] ? (+d[xVal]) : 0,\n          'Amount Awarded': d[yVal] ? (+d[yVal]) : 0,\n          'filterLocation': d.filterLocation,\n          'placeName': d.placeName\n        }\n      });\n\n      // console.log(data);\n  \n      var margin = {top: 20, right: 20, bottom: 90, left: 90},\n      width = this.props.dimensions.width - margin.left - margin.right,\n      height = this.props.dimensions.height - margin.top - margin.bottom,\n      node = select(this.node);\n  \n      // const xVal = this.props.xVal;\n      const xValues = data.map(d => +d[xVal]);\n      const yValues = data.map(d => +d[yVal]);\n\n      const smallRadius = 2;\n      const bigRadius = 15;\n      const smallStroke = 1;\n      const bigStroke = 3;\n\n\n      const [yMin, yMax] = getExtent(yValues,this.props.yMinLimit,true);\n      const [xMin, xMax] = getExtent(xValues);\n\n      let tooltip = tip()\n        .attr('class', 'd3-tip')\n        .offset(d => {\n          if (d[xVal] > (xMax-xMin)/2)\n            return [0, -20];\n          else\n            return [0, 20];\n        })\n        .direction(d => {\n          if (d[xVal] > (xMax-xMin)/2)\n            return 'w';\n          else\n            return 'e';\n        })\n        .html((d) => {\n          // console.log(d);\n          return makeTooltip(\n            d.placeName + \" [\" + d.id + \"]\",\n            [\n              {label:this.props.xValLabel.label, value:format(\",.2f\")(d[xVal])},\n              {label:\"Amount Awarded\", value:\"\"+format(\",.0f\")(d[yVal])}\n            ]\n          )\n        })\n\n      data = data.filter(d => {\n        // console.log(this.props.yMinLimit,+d[yVal]);\n        return +d[yVal]>=yMin;\n      });\n      const unfiltered = data.filter(d => !d.filterLocation)\n      const filtered = data.filter(d => d.filterLocation)\n      data = unfiltered.concat(filtered);\n      \n      // set the ranges\n      var x = scaleLinear()\n                .range([0, width])\n                .domain([xMin, xMax])\n                // .padding(0.1);\n      var y = scaleLog()\n                .range([height, 0])\n                .domain([yMin,yMax])\n          \n    const colorScale = getColorScale(extent(xValues));\n\n    const zoomed = () => {\n      // create new scale ojects based on event\n      var new_xScale = event.transform.rescaleX(x);\n      var new_yScale = event.transform.rescaleY(y);\n      var new_xScale_to_call = xAxis.scale(new_xScale);\n      var new_yScale_to_call = yAxis.scale(new_yScale);\n      // update axes\n      gX.call(new_xScale_to_call);\n      gY.call(new_yScale_to_call);\n      points.data(data.filter(d => +d[yVal]>=yMin))\n        .attr('cx', function(d) {return new_xScale(d[xVal])})\n        .attr('cy', function(d) {return new_yScale(d[yVal])});\n\n      const [xMin,xMax] = new_xScale_to_call.scale().range();\n      tooltip.offset(d => {\n          if (new_xScale(d[xVal]) > (xMax-xMin)/2)\n            return [0, -20];\n          else\n            return [0, 20];\n        })\n        .direction(d => {\n          if (new_xScale(d[xVal]) > (xMax-xMin)/2)\n            return 'w';\n          else\n            return 'e';\n        })\n    }\n\n    node.selectAll(\"g\").remove();\n\n    // console.log([width,height]);\n\n    // Clip Path for scatter plot points\n    node.append(\"defs\").append(\"clipPath\")\n        .attr(\"id\", \"clip\")\n      .append(\"rect\")\n        .attr(\"width\", width)\n        .attr(\"height\", height);\n\n    \n\n    let zoom = d3zoom()\n      .scaleExtent([.5, 20])\n      .extent([[0, 0], [width, height]])\n      .on(\"zoom\", zoomed);\n    \n    node.append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .style(\"fill\", \"none\")\n      .style(\"pointer-events\", \"all\")\n      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n      .call(zoom);\n\n    const g = node.append('g');\n    g.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n      .style(\"pointer-events\", \"all\");\n\n    const gForPoints = g.append('g')\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"clip-path\", \"url(#clip)\");\n\n    let points = gForPoints.selectAll(\".dot\")\n      .data(data)\n    .enter().append(\"circle\")\n      .attr(\"class\", \"dot\")\n      .attr(\"r\", smallRadius)\n      .attr(\"stroke\", '#99999933')\n      .attr(\"stroke-width\", smallStroke)\n      .attr(\"cx\", d => x(+d[xVal]) )\n      .attr(\"cy\", d => y(+d[yVal]) )\n      .attr('fill', d => d['filterLocation'] ? convertHex(colorScale(+d[xVal]),opacity) : \"rgba(0,0,0,0)\")\n      .on('mouseover', function(d) {\n        tooltip.show(d,this);\n        select(this)\n          .attr(\"r\", bigRadius)\n          .attr(\"fill\",convertHex(colorScale(+d[xVal]),opacity))\n          .attr(\"stroke\", \"#f48320\")\n          .attr(\"stroke-width\", bigStroke);\n      })\n      .on('mouseout', function(d) {\n        tooltip.hide();\n        select(this)\n          .attr(\"r\", smallRadius)\n          .attr(\"fill\",d => d['filterLocation'] ? convertHex(colorScale(+d[xVal]),opacity) : \"rgba(0,0,0,0)\")\n          .attr(\"stroke\", '#99999933')\n          .attr(\"stroke-width\", smallStroke);\n      })\n      .on('click', function(d) { \n        tooltip.hide();\n        filterFunc({'location': [d['id']] },true);\n      });\n\n    \n\n    node.call(tooltip);\n\n    \n\n\n    // add the x Axis\n    let xAxis = axisBottom(x).ticks(4).tickFormat( format(\".3s\") );\n    let gX = g.append(\"g\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(xAxis);\n    \n    // Clip Path for Y Axis\n    g.append(\"defs\").append(\"clipPath\")\n    .attr(\"id\", \"clipYAxis\")\n    .append(\"rect\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .attr(\"transform\", \"translate(\" + (-margin.left) + \",0)\");\n\n    // add the y Axis\n    let yAxis = axisLeft(y)\n    .tickValues(getPowersOf10(yMin,yMax))  \n    .tickFormat(function(d) {return \"\"+format(\".1s\")(d)\n      .replace('M', ' mil')\n      .replace('G', ' bil')\n    })\n    let gY = g.append(\"g\")\n    .attr(\"clip-path\", \"url(#clipYAxis)\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .call(yAxis);\n    \n    node.append(\"g\")\n      .append(\"text\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"y\", 10)\n      .attr(\"x\",0 - (height / 2))\n      .attr(\"dy\", \"1em\")\n      .style(\"text-anchor\", \"middle\")\n      .text(\"Amount Awarded ()\"); \n    \n    node.append(\"g\")\n      .append(\"text\")            \n      .attr(\"transform\",\n            \"translate(\" + (margin.left + width/2) + \" ,\" + (height + margin.bottom - 20) + \")\")\n      .style(\"text-anchor\", \"middle\")\n      .text(this.props.xValLabel.label);\n\n    }\n    \n    \n\n    render() {\n        return (\n      <div className=\"DonorBarChart\">\n        <svg ref={node => this.node = node}\n          width={this.props.dimensions.width} height={this.props.dimensions.height}>\n        </svg>\n      </div>\n      );\n    }\n}\n\nDeprivationScatterPlot.propTypes = {}\n\nDeprivationScatterPlot.defaultProps = {}\n\nexport default DeprivationScatterPlot\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './DonorBarChart.scss'\nimport { select } from 'd3-selection'\nimport { scaleBand,scaleLinear } from 'd3-scale'\nimport { axisBottom, axisLeft } from 'd3-axis'\nimport { format } from 'd3-format'\nimport { makeTooltip } from '../../VizHelpers'\nimport _ from 'lodash'\nimport { default as tip } from 'd3-tip'\n\n\nclass DonorBarChart extends Component {\n  constructor(props){\n    super(props)\n    this.createBarChart = this.createBarChart.bind(this)\n  }\n  componentDidMount() {\n    this.createBarChart()\n  }\n  \n  componentDidUpdate() {\n    this.createBarChart()\n  }\n\n  createBarChart() {\n    let data = this.props.data;\n    // select('.d3-tip').remove();\n\n    let tooltip = tip()\n      .attr('class', 'd3-tip')\n      .offset([0, 20])\n      .direction(d => 'e')\n      .html((d) => {\n        return makeTooltip(\n          d.year,\n          [\n            {label:\"Number of projects\", value:d.projects},\n            {label:\"Amount Awarded\", value:\"\"+format(\",.0f\")(d.amount)}\n          ]\n        )\n      })\n\n    // console.log(data);\n\n    var margin = {top: 10, right: 10, bottom: 40, left: 60},\n    width = 300 - margin.left - margin.right,\n    height = 150 - margin.top - margin.bottom,\n    node = select(this.node);\n\n    const values = data.values.map(d => d.value['total_awarded']);\n    const dataForChart = data.values\n      .map(d => \n        ({\n          year:parseInt(d.key),\n          amount:d.value['total_awarded'],\n          projects:d.value['projects']\n        }) \n      );\n\n    // set the ranges\n    var x = scaleBand()\n              .range([0, width])\n              .domain([2013,2014,2015,2016,2017,2018])\n              .padding(0.1);\n    var y = scaleLinear()\n              .range([height, 0])\n              .domain([0,_.max(values)]);\n\n\n    // console.log(values);\n\n    node.selectAll(\"g\").remove();\n  \n    const g = node.append('g');\n    g.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    g.selectAll(\".bar\")\n      .data(dataForChart)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar\")\n      .attr(\"x\", function(d) { \n        return x(d.year); })\n      .attr(\"width\", x.bandwidth())\n      .attr(\"y\", function(d) { return y(d.amount); })\n      .attr(\"fill\", '#6e40e6')\n      // .attr(\"fill\", '#602f8f')\n      .attr(\"height\", function(d) { return height - y(d.amount); })\n      .on('mouseover', function(d) {\n        tooltip.show(d,this);\n        select(this)\n          .attr(\"fill\", \"#f48320\");\n      })\n      .on('mouseout', function(d) {\n        tooltip.hide();\n        select(this)\n          .attr(\"fill\", '#6e40e6');\n      });\n\n    // add the x Axis\n    g.append(\"g\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(axisBottom(x));\n\n    // add the y Axis\n    g.append(\"g\")\n    .call(axisLeft(y)\n      .ticks(4)\n      .tickFormat(function(d) {return \"\"+format(\".3s\")(d)\n        .replace('M', ' mil')\n        .replace('G', ' bil')\n      }));\n    \n\n    node.call(tooltip);\n  }\n\n  render() {\n    return (\n      <div className=\"DonorBarChart\">\n        <svg className=\"StackedBarChart\" ref={node => this.node = node}\n          width={300} height={150}>\n        </svg>\n      </div>\n    );\n}\n}\n\nDonorBarChart.propTypes = {}\n\nDonorBarChart.defaultProps = {}\n\nexport default DonorBarChart\n\n","import React, { Component } from 'react'\n// import PropTypes from 'prop-types'\nimport { getColorScale, convertHex, makeTooltip, getExtent } from '../../VizHelpers'\nimport { format } from 'd3-format'\nimport { legendColor } from 'd3-svg-legend'\nimport { select } from 'd3-selection'\nimport mapboxgl from 'mapbox-gl'\nimport './MapComponent.scss'\nimport { extent } from 'd3-array'\nimport _ from 'lodash'\n// import { topojson } from '@mapbox/leaflet-omnivore';\n// import { L } from 'leaflet';\n\n\nmapboxgl.accessToken = 'pk.eyJ1IjoieWFubmF1bmdvYWsiLCJhIjoiY2prdWVzemFqMGZ6dzNzbnc0Z3N0enBiMiJ9.TFt7qYDiE1k5bBt7NdFCrQ';\n\nclass MapComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      opacity: 90,\n      mainLayerId: 'admin-level-boundaries',\n      sources: [],\n      geoId: ''\n    }\n  }\n\n  setStateForMe = (state) => this.setState(state);\n  callBackFuncClick = () => null;\n  callBackFuncMMove = () => null;\n  callBackFuncMLeave = () => null;\n\n  popup = new mapboxgl.Popup({\n    closeButton: false,\n    anchor: 'left',\n    offset: [10,0]\n  });\n\n  componentDidMount() {\n    const { opacity,mainLayerId } = this.state;\n\n    console.log(\"Running ComponentDidMount on Map\")\n\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/mapbox/streets-v9',\n      center: this.props.mapFormatting.position,\n      zoom: this.props.mapFormatting.zoom\n    });\n\n    let myMap = this.map;\n\n    \n\n    myMap.on('load', () => {\n      const {mapData, scatterPlotData, xVal, xValLabel, yMinLimit, mapGeoId, mapGeoPlaceName,allMapSources,addFilter} = this.props;\n      const expression = this.buildDataLayer(mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName, opacity, yMinLimit);\n      \n      console.log(allMapSources);\n\n      console.log(this.props);\n\n      this.setState({\n        sources: []\n      })\n      allMapSources.forEach(d => this.addSource(d.sourceName,d.filePath,d.type,d.sourceLayer));\n      this.addDataLayer(expression,mapData,allMapSources);\n      this.setUpMouseOver(mainLayerId,mapData,mapGeoPlaceName,mapGeoId,this.popup,\n        scatterPlotData,xVal,xValLabel);\n      console.log(\"calling setuponlick from componentDidMount\");\n      this.setUpOnClick(mainLayerId,mapGeoId,addFilter);\n      \n\n    });\n\n  }\n\n  setUpOnClick(mainLayerId,mapGeoId,filterFunc) {\n    let myMap = this.map;\n\n    myMap.off('click', mainLayerId, this.callBackFuncClick);\n\n    this.callBackFuncClick = (e) => {\n      const placeCode = e.features[0].properties[mapGeoId];\n      filterFunc({'location': [placeCode] },true);\n    }\n\n    myMap.on('click', mainLayerId, this.callBackFuncClick);\n  }\n\n  setUpMouseOver(mainLayerId,mapData,mapGeoPlaceName,mapGeoId,\n    popup,scatterPlotData,xVal,xValLabel) {\n    let hoveredStateId =  null;\n\n    let myMap = this.map;\n    // console.log(mapGeoId);\n    myMap.off(\"mousemove\", mainLayerId, this.callBackFuncMMove);\n    myMap.off(\"mouseleave\", mainLayerId, this.callBackFuncMLeave);\n\n\n    this.callBackFuncMMove = (e) =>  {\n\n      if (e.features.length > 0) {\n        if (hoveredStateId) {\n          myMap.setFeatureState({source: mapData, sourceLayer:mapData, id: +hoveredStateId}, { hover: false});\n        }\n        hoveredStateId = e.features[0].id;\n        if (!hoveredStateId) hoveredStateId = e.features[0].properties.objectid;\n        myMap.setFeatureState({source: mapData, sourceLayer:mapData, id: +hoveredStateId}, { hover: true});\n\n        const placeName = e.features[0].properties[mapGeoPlaceName];\n        const placeCode = e.features[0].properties[mapGeoId];\n        const tooltipTitle = placeName + \" [\" + placeCode + \"]\";\n        const scatterDataPoint = scatterPlotData.filter(d => d.id === placeCode);\n        const tooltipVars = scatterDataPoint.length > 0 \n        ? [\n            {label:xValLabel.label, value:format(\",.2f\")(scatterDataPoint[0][xVal])},\n            {label:\"Amount Awarded\", value:\"\"+format(\",.0f\")(scatterDataPoint[0]['Amount Awarded'])}\n          ]\n        : [];\n\n        // Display a popup with the name of the location\n        popup.setLngLat(e.lngLat)\n          .setHTML(makeTooltip(tooltipTitle,tooltipVars))\n          .addTo(myMap);\n\n        }\n      }\n\n      this.callBackFuncMLeave = () => {\n        if (hoveredStateId) {\n          myMap.setFeatureState({source: mapData, sourceLayer:mapData, id: hoveredStateId}, { hover: false});\n        }\n        hoveredStateId =  null;\n        popup.remove();\n      }\n\n    // When the user moves their mouse over the state-fill layer, we'll update the\n    // feature state for the feature under the mouse.\n    myMap.on(\"mousemove\", mainLayerId, this.callBackFuncMMove);\n    \n    // When the mouse leaves the state-fill layer, update the feature state of the\n    // previously hovered feature.\n    myMap.on(\"mouseleave\", mainLayerId, this.callBackFuncMLeave);\n\n  }\n\n  buildDataLayer(mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName, opacity, yMinLimit) {\n\n    const yLabel = 'Amount Awarded'\n\n    const xValues = scatterPlotData.map(d => +d[xVal]);\n    const yValues = scatterPlotData.map(d => +d[yLabel]);\n        \n    const colorScale = getColorScale(extent(xValues));\n    let [yMin, yMax] = getExtent(yValues,yMinLimit,true);\n\n    let expression = [\"match\", [\"get\", mapGeoId]];\n    // console.log([yMin, yMax]);\n\n    scatterPlotData.forEach(function(row) {\n      // console.log(yMin,+row[yLabel],row[\"filterLocation\"])\n      const color = (row[\"filterLocation\"] && +row[yLabel] >= yMin)\n        ? convertHex(colorScale(+row[xVal]),opacity) \n        : \"rgba(0,0,0,0)\" ;\n      expression.push(row[\"id\"], color);\n    });\n\n    expression.push(\"rgba(0,0,0,0)\");\n\n    var svg = select(\"#legendContainer\");\n    svg.selectAll(\"g\").remove();\n\n    svg.append(\"g\")\n      .attr(\"class\", \"legendQuant\");\n\n    var legend = legendColor()\n      .labelFormat(format(\".3s\"))\n      // .useClass(true)\n      .titleWidth(100)\n      .scale(colorScale);\n\n    svg.select(\".legendQuant\")\n      .call(legend);\n\n\n    return expression;\n  }\n\n  addSource(sourceName,filePath,type,sourceLayer) {\n    console.log(sourceName,filePath,type)\n    let metadata = {\n      type: type,\n    };\n    if (type === 'vector') {\n      metadata['url'] = filePath;\n      // metadata['source'] = {type: type, url: filePath}\n    } else {\n      metadata['data'] = filePath;\n      metadata['generateId'] = true;\n    }\n    console.log(metadata)\n\n    this.map.addSource(sourceName, metadata);\n\n\n    // topojson(filePath)\n    //   .addTo(this.map);\n\n  }\n\n  addDataLayer(expression,sourceName,mapSources) {\n    console.log(this.state.sources);\n    mapSources = mapSources.filter(d => d.sourceName === sourceName)[0];\n    let layerMetaDataForFill = {\n      id: this.state.mainLayerId,\n      type: 'fill',\n      source: sourceName,\n      \"paint\": {\n        \"fill-color\": expression,\n        \"fill-outline-color\": \"rgba(0,0,0,0.1)\"\n      }\n    }\n    if (mapSources.type === 'vector') {\n      layerMetaDataForFill[\"source-layer\"] = mapSources.sourceLayer;\n      layerMetaDataForFill.source = {type: mapSources.type, url: mapSources.filePath}\n    }\n    this.map.addLayer(layerMetaDataForFill, 'place-city-sm');\n    this.setState({\n      sources: _.uniq([...this.state.sources, this.state.mainLayerId])\n    })\n\n\n    let layerMetaDataForHighlight = {\n      id: (this.state.mainLayerId+'_highlight'),\n      type: 'line',\n      source: sourceName,\n      \"paint\": {\n        \"line-color\": [\"case\",\n          [\"boolean\", [\"feature-state\", \"hover\"], false],\n            \"#f48320\",\n            \"rgba(0,0,0,0.1)\"\n          ],\n          \"line-width\": [\"case\",\n          [\"boolean\", [\"feature-state\", \"hover\"], false],\n            2,\n            0\n          ]\n        }\n      }\n    if (mapSources.type === 'vector') {\n      layerMetaDataForHighlight[\"source-layer\"] = mapSources.sourceLayer;\n      layerMetaDataForHighlight.source = {type: mapSources.type, url: mapSources.filePath}\n    }\n    this.map.addLayer(layerMetaDataForHighlight);\n    this.setState({\n      sources: _.uniq([...this.state.sources, this.state.mainLayerId+'_highlight'])\n    })\n\n    console.log(this.map);\n  }\n\n  removeDataLayer() {\n    console.log(this.state.sources);\n    this.map.removeLayer(this.state.mainLayerId);\n    this.map.removeLayer(this.state.mainLayerId+'_highlight');\n    let removedSourcesIndex = []\n    this.state.sources.forEach((s,i) => {\n      if (this.map.style.sourceCaches[s]) {\n        this.map.removeSource(s)\n      } \n      removedSourcesIndex.push(i)\n    });\n    console.log(removedSourcesIndex);\n    this.setState({\n      sources: _.uniq(this.state.sources)\n    })\n  }\n  \n  \n  componentWillUnmount() {\n    this.map.remove();\n  }\n\n\n  componentWillReceiveProps(nextProps) {\n    \n    if (nextProps.mapData !== this.props.mapData ||\n      nextProps.mapGeoId !== this.props.mapGeoId ||\n      nextProps.scatterPlotData !== this.props.scatterPlotData ||\n      nextProps.xVal !== this.props.xVal) \n    {\n      console.log(\"Map received new props\")\n      // console.log(nextProps)\n      const {mapData, scatterPlotData, xVal, xValLabel, yMinLimit, mapGeoId, mapGeoPlaceName, addFilter, allMapSources} = nextProps;\n      const { opacity } = this.state;\n\n      const waiting = () => {\n        if (!this.map.isStyleLoaded() || !this.map.getLayer(this.state.mainLayerId)) {\n          setTimeout(waiting, 200);\n        } else {\n          this.removeDataLayer();\n          // allMapSources.forEach(d => this.addSource(d.sourceName,d.filePath,d.type,d.sourceLayer));\n\n          console.log(this.map);\n          const expression = this.buildDataLayer(mapData, scatterPlotData, \n            xVal, mapGeoId, mapGeoPlaceName, opacity, yMinLimit);\n          this.addDataLayer(expression,mapData,allMapSources);\n          this.setUpMouseOver(this.state.mainLayerId,mapData,mapGeoPlaceName,\n            mapGeoId,this.popup,scatterPlotData,xVal,xValLabel);\n          // console.log(\"calling setuponlick from componentWillReceiveProps\");\n          this.setUpOnClick(this.state.mainLayerId,mapGeoId,addFilter);\n\n        }\n      }\n      waiting();\n    } else console.log('Still loading data');\n  }\n  \n\n  render() {\n    const style  ={\n      position: 'relative',\n      // top: 0,\n      width: this.props.dimensions.width,\n      height: this.props.dimensions.height\n    };\n\n    \n    return <div className=\"MapComponent\" >\n      <div style={style} ref={el => this.mapContainer = el} className=\"absolute top right left bottom MapComponentMap\">\n      <div className='map-overlay top'>\n        <div className='map-overlay-inner'>\n          <svg id=\"legendContainer\">\n\n          </svg>\n        </div>\n      </div>\n      </div>\n      \n    </div>\n  }\n\n    \n}\n\nMapComponent.propTypes = {}\n\nMapComponent.defaultProps = {}\n\nexport default MapComponent\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './BodyComponent.scss'\nimport { Grid, Row, Col } from 'react-flexbox-grid';\nimport DeprivationScatterPlot from '../DeprivationScatterPlot/DeprivationScatterPlot';\nimport DonorBarChart from '../DonorBarChart/DonorBarChart';\nimport MapComponent from '../MapComponent/MapComponent';\nimport Slider, { createSliderWithTooltip } from 'rc-slider';\nimport MultiSelect from \"@kenshooui/react-multi-select\";\nimport { prepKeyValuePairs, locationLabelFunc, donorLabelFunc } from '../../Utils';\nimport 'rc-slider/assets/index.css';\nimport \"@kenshooui/react-multi-select/dist/style.css\"\nimport { selector } from 'd3-selection';\nimport ReactMarkdown from 'react-markdown';\nimport Popup from 'reactjs-popup';\n\n\nconst YearSlider = createSliderWithTooltip(Slider.Range);\n\nconst Card = ({content}) => (\n  <div className=\"card\">\n    <div className=\"content\">\n      <ReactMarkdown source={content} />\n    </div>\n  </div>\n)\n\nclass BodyComponent extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      yearsRange: this.props.yearsRange ? this.props.yearsRange : [2013,2018],\n      showSelectorLocations: false,\n      showSelectorDonors: false,\n      locationsList: [],\n      donorsList: [],\n    }\n  }\n  \n  componentDidMount() { \n    this.setNewLocationsList(this.props.scatterPlotData);\n    this.setNewDonorsList(this.props.smallMultiplesData);\n\t} \n\n  setNewLocationsList(newList) {\n    this.setState({ \n      locationsList: newList \n        ? prepKeyValuePairs(newList,'id',locationLabelFunc,'filterLocation')\n        : [{id: 'test', label: 'placeholder'}]\n      })\n  }\n\n  setNewDonorsList(newList) {\n    this.setState({ \n      donorsList: newList \n        ? prepKeyValuePairs(newList,'key',donorLabelFunc,'filterDonor')\n        : [{id: 'test', label: 'placeholder'}]\n      })\n  }\n\n  locationValueRenderer = (selected, options) => {\n    if (selected.length === 0) return \"Slect some locations...\";\n    if (selected.length === options.length) return \"All locations selected\";\n    return `Selected ${selected.length} locations`;\n  }\n\n  donorValueRenderer = (selected, options) => {\n    if (selected.length === 0) return \"Slect some grant makers...\";\n    if (selected.length === options.length) return \"All grant makers selected\";\n    return `Selected ${selected.length} grant makers`; \n  }\n\n  toggleSelector = (selector) => {\n    console.log('show selector ' + selector);\n    if (selector === 'locations') this.setState({showSelectorLocations: !this.state.showSelectorLocations});\n    if (selector === 'donors') this.setState({showSelectorDonors: !this.state.showSelectorDonors});\n  }\n\n  filterLocations = (selectedLocations) => {\n    if (selectedLocations.length === this.state.locationsList.length)\n      this.props.addFilter({'location': 'reset' },false);\n    else\n      this.props.addFilter({'location': selectedLocations.map(d => d.id) },false);\n  }\n\n  filterDonors = (selectedDonors) => {\n    // console.log(selectedDonors)\n    if (selectedDonors.length === this.state.donorsList.length)\n      this.props.addFilter({'donor': 'reset' },false);\n    else\n      this.props.addFilter({'donor': selectedDonors.map(d => d.id) },false);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.scatterPlotData !== this.props.scatterPlotData) {\n      this.setNewLocationsList(nextProps.scatterPlotData)\n    }\n    if (nextProps.smallMultiplesData !== this.props.smallMultiplesData) {\n      this.setNewDonorsList(nextProps.smallMultiplesData)\n    }\n  }\n\n  \n\n  render() {\n    // console.log(this.props);\n\n    const mapAndScatterWidth = this.props.dimensions.width <= 800 \n      ? this.props.dimensions.width *0.8\n      : this.props.dimensions.width *0.45;\n\n    return (\n      <div className=\"BodyComponent\">\n        <Grid fluid>\n          <Row className='filtersRow'>\n            <Col xs className='col leftCol'>\n            <button onClick={() => this.toggleSelector('locations')} className=\"filterButton\">\n              {this.state.showSelectorLocations \n                ? <span>Close location selector</span> \n                : <span>Filter locations</span> \n              }\n            </button>\n            <button onClick={this.props.addFilter.bind(this,{'location': 'reset'})} className=\"filterButton\">\n              <span>Reset location filters</span>\n            </button>\n            <Popup\n              trigger={<button className=\"button popUp\"> i </button>}\n              position=\"right center\"\n              on=\"click\"\n            >\n              <Card content={this.props.infoBoxes['test'].content} />\n            </Popup>\n            {this.state.showSelectorLocations \n              ? <div className=\"multiSelector\">\n                <MultiSelect\n                  items={this.state.locationsList}\n                  selectedItems={this.state.locationsList.filter(d => d.filter)}\n                  onChange={this.filterLocations}\n                />\n              </div>\n              : null}\n            </Col>\n            <Col xs className='col rightCol'> \n              Filter years: \n              \n              <YearSlider className='yearsSlider'\n                allowCross={true}\n                defaultValue={[this.state.yearsRange[0],this.state.yearsRange[1]+1]}\n                min={2013}\n                max={2019}\n                // tipFormatter={formatter()}\n                onAfterChange={(range) => this.props.addFilter({'years': range })}\n                // onAfterChange={(range) => this.setState({yearsRange: range })}\n                // tipProps={{ placement: 'top', prefixCls: 'rc-tooltip'}}\n                dots={true}\n                pushable={true}\n                width={200}\n                  />\n            </Col>   \n            <Col xs className='col'>\n            <button onClick={() => this.toggleSelector('donors')} className=\"filterButton\">\n              {this.state.showSelectorDonors \n                ? <span>Close grant makers selector</span> \n                : <span>Filter grant makers</span> \n              }\n            </button>\n            <button onClick={this.props.addFilter.bind(this,{'donor': 'reset'})} className=\"filterButton\">\n              <span>Reset grant maker filters</span>\n            </button>\n            {this.state.showSelectorDonors \n              ? <div className=\"multiSelector\">\n                <MultiSelect\n                  items={this.state.donorsList}\n                  selectedItems={this.state.donorsList.filter(d => d.filter)}\n                  onChange={this.filterDonors}\n                />\n              </div>\n              : null}\n            </Col>\n          </Row>\n          <Row>\n            <Col xs className='col'> \n              {/* Hello uptown */}\n              <MapComponent \n                mapFormatting={this.props.mapFormatting}\n                scatterPlotData={this.props.scatterPlotData}\n                mapData={this.props.mapData}\n                allMapSources={this.props.allMapSources}\n                xVal={this.props.scatterPlotXVal}\n                xValLabel={this.props.scatterPlotXValLabel}\n                yMinLimit={this.props.yMinLimit}\n                mapGeoId={this.props.mapGeoId}\n                mapGeoPlaceName={this.props.mapGeoPlaceName}\n                dimensions={({width:mapAndScatterWidth,height:mapAndScatterWidth})}\n                addFilter={this.props.addFilter.bind(this)}\n              />\n            </Col>\n            <Col xs className='col'> \n              {/* Hello midtown */}\n              <div className='scatterplotView'>\n              <DeprivationScatterPlot\n                data={this.props.scatterPlotData}\n                xVal={this.props.scatterPlotXVal}\n                xValLabel={this.props.scatterPlotXValLabel}\n                yMinLimit={this.props.yMinLimit}\n                dimensions={({width:mapAndScatterWidth,height:mapAndScatterWidth})}\n                addFilter={this.props.addFilter.bind(this)}\n              />\n            </div>\n            </Col>\n            </Row>\n            <Row>\n              <Col xs className='col smallMultiplePlotsContainer'>\n                <h3>Amounts awarded over time by individual granmakers in selected areas</h3>\n              </Col>\n            </Row>\n            <Row>\n              <Col xs className='col smallMultiplePlotsContainer'> \n                {/* Hello downtown  */}\n                {this.props.smallMultiplesData\n                  .filter(d => d.filterDonor && d.notZero)\n                  .map((d,i) => <div className='smallMultiplePlot' key={'smallMultiPlePlot'+i}>\n                  <div className='smallMultipleHeader'>{d.key}</div><br/>\n                  <DonorBarChart\n                    data = {d}\n                  />\n                </div>)}\n              </Col>\n          </Row>\n        </Grid>\n        {/* <MultiSelect\n          options={this.state.locationsList}\n          selected={[]}\n          valueRenderer={this.locationValueRenderer}\n          selectAllLabel=\"All locations\"\n        /> */}\n        \n      </div>\n      \n    );\n  }\n}\n\nBodyComponent.propTypes = {}\n\nBodyComponent.defaultProps = {}\n\nexport default BodyComponent\n","import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport { loadAllData } from './DataLoading';\nimport { prepAllData } from './DataHandling';\nimport FiltersComponent from './components/FiltersComponent/FiltersComponent';\nimport BodyComponent from './components/BodyComponent/BodyComponent';\nimport _ from 'lodash';\n\nimport { Grid, Row, Col } from 'react-flexbox-grid';\nimport Select from 'react-select';\n\n\nclass App extends Component {\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tdata: [],\n\t\t\tmutatedData: {\n\t\t\t\t// companyPayments: []\n\t\t\t},\n\t\t\tlayerControls: [],\n\t\t\tselectedRegion: 'eng',\n\t\t\tselectedGeoLevel: 'LAD',\n\t\t\tselectedComparison: ['deprivation','comparison_IMD_avg_score'],\n\t\t\tfilters: {},\n\t\t\tyMinLimit: 1000,\n\t\t\tdimensions: {\n\t\t\t\twidth: window.innerWidth,\n\t\t\t\theight: window.innerHeight\n\t\t\t}\n\t\t}\n\t\tthis.updateDimensions = this.updateDimensions.bind(this);\n\t}\n  \n\t\n\taddFilter = (filters,toggle) => {\n\t\t// console.log(filters)\n\t\tconst filterKeys = Object.keys(filters);\n\t\tlet newFilterObj = this.state.filters;\n\n\t\tfilterKeys.forEach(k => {\n\t\t\t// console.log(newFilterObj[k]);\n\t\t\t// console.log(filters[k]);\n\t\t\tif (!toggle || filters[k]==='reset' \n\t\t\t|| !newFilterObj[k] || newFilterObj[k]==='reset') {\n\t\t\t\tnewFilterObj[k] = filters[k];\n\t\t\t} else {\n\t\t\t\tlet consolidatedFilters = [];\n\t\t\t\tconsolidatedFilters = consolidatedFilters\n\t\t\t\t\t.concat(newFilterObj[k].filter(d => !(filters[k]).includes(d)));\n\t\t\t\t// console.log(consolidatedFilters);\n\t\t\t\tconsolidatedFilters =\tconsolidatedFilters\n\t\t\t\t\t.concat(filters[k].filter(d => !(newFilterObj[k]).includes(d)));\n\t\t\t\t// console.log(consolidatedFilters);\n\n\t\t\t\tnewFilterObj[k] = consolidatedFilters;\n\t\t\t}\n\t\t})\n\n\t\tthis.setState({\n\t\t\tfilters: newFilterObj,\n\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\tthis.state.selectedRegion,\n\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\tthis.state.selectedComparison,\n\t\t\t\tnewFilterObj)\n\t\t});\n\t\t\n\t}\n\n  componentDidMount() { \n\t\twindow.addEventListener(\"resize\", this.updateDimensions);\n\t\tthis.getData();\n  }  \n  \n  // shouldComponentUpdate(nextProps, nextState) {\n  //   console.log(nextState);\n  //   if (this.state.mutatedData === nextState.mutatedData) {\n  //     console.log(\"Component should not update\")\n  //     return false;\n  //   } else {\n  //     console.log(\"Component should update\")\n  //     return true;\n  //   }\n  // }\n\t\n\tupdateDimensions() {\n    this.setState({\n      dimensions: {\n\t\t\t\theight: window.innerHeight, \n\t\t\t\twidth: window.innerWidth\n\t\t\t}\n    });\n  }\n\t\n  prepAndloadDataToState(data,initialCall) {\n    console.log(data);\n    this.setState({rawData: data})\n    return Promise.all([ \n      prepAllData(data,\n        this.state.selectedRegion,\n        this.state.selectedGeoLevel,\n        this.state.selectedComparison,\n        this.state.filters,\n        this.state.yMinLimit\n      )\n    ])\n    .then(data => {\n      console.log(data[0])\n      const processedData = data[0]\n      // set initial data\n      this.setState({ data: data[0] },\n        () => {\n          if (initialCall) {\n            // set mutated data to initial data on load so filters can access data changes\n            this.setState({ \n              mutatedData: this.state.data \n            },\n              () => {\n                console.log(`(mutatedData === data) : ${this.state.mutatedData === this.state.data}`)\n                console.log(this.state.mutatedData);\n              }\n            )\n          }\n        }\n      )\n    return processedData;\n    })\n\n  }\n\n\tgetData() {\n    loadAllData()\n      .then(data => this.prepAndloadDataToState(data,true))\n      // .then(() => loadAllData(\"large\",this.state.rawData))\n      // .then(data => this.prepAndloadDataToState(data,false))  \n\n\n      // .then(data => prepAllData(data,\n      //   this.state.selectedRegion,\n      //   this.state.selectedGeoLevel,\n      //   this.state.selectedComparison,\n      //   this.state.filters,\n      //   this.state.yMinLimit)\n      // )\n      // .then(data =>\n      //   // set initial data\n      //   this.setState({ data },\n      //     () => {\n      //       // set mutated data to initial data on load so filters can access data changes\n      //       this.setState({ mutatedData: this.state.data },\n      //         () => {\n      //           console.log(`(mutatedData === data) : ${this.state.mutatedData === this.state.data}`)\n      //           console.log(this.state.mutatedData);\n      //         }\n      //       )}\n      // ))\n      // .then()\n  }\n  \n\n\n  render() {\n    console.log(this.state);\n\n\t\tconst handleRegionChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedRegion: selectedOption.value,\n\t\t\t\tfilters: {},\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\t\tthis.state.selectedComparison,\n\t\t\t\t\t{},\n\t\t\t\t\tthis.state.yMinLimit)\n\t\t\t});\n\t\t\tconsole.log(`Location selected:`, selectedOption);\n\t\t}\n\n\t\tconst handleGeoChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedGeoLevel: selectedOption.value,\n\t\t\t\tfilters: {},\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tthis.state.selectedRegion,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.selectedComparison,\n\t\t\t\t\t{},\n\t\t\t\t\tthis.state.yMinLimit)\n\t\t\t});\n\t\t\tconsole.log(`Geo level selected:`, selectedOption);\n\t\t}\n\n\t\tconst handleComparisonChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedComparison: selectedOption.value,\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tthis.state.selectedRegion,\n\t\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.filters,\n\t\t\t\t\tthis.state.yMinLimit)\n\t\t\t});\n\t\t\tconsole.log(`Comparison var selected:`, selectedOption);\n\t\t}\n\n\t\tconst getComparisonVarLabel = () => {\n\t\t\treturn this.state.data.comparisonVars\n\t\t\t\t.filter(d => d.value[0] == this.state.selectedComparison[0] &&\n\t\t\t\t\td.value[1] == this.state.selectedComparison[1])[0]\n\t\t}\n\n\t\tconst isLoading = !!(_.isEmpty(this.state.data)) ? true : false;\n\n\t\tconst regionPicker = <div className='regionPickerWrapper'>\n\t\t\t<label>\n\t\t\t\tRegion: \n\t\t\t\t{!!isLoading\n          ? 'loading'\n          :\t<Select\n\t\t\t\t\t\t\tvalue={this.state.data.regions[this.state.selectedRegion]}\n\t\t\t\t\t\t\tonChange={handleRegionChange}\n\t\t\t\t\t\t\toptions={Object.values(this.state.data.regions)}\n\t\t\t\t\t\t\tclassName='regionPicker'\n\t\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t</label>\n\t\t</div>\n\n\t\tconst geoPicker = <div className='geoPickerWrapper'>\n\t\t\t<label>\n\t\t\t\tAdministrative Level: \n\t\t\t\t\t{!!isLoading\n\t\t\t\t\t? 'loading'\n\t\t\t\t\t:\t<Select\n\t\t\t\t\t\t\tvalue={this.state.data.geoLevels[this.state.selectedGeoLevel]}\n\t\t\t\t\t\t\tonChange={handleGeoChange}\n\t\t\t\t\t\t\toptions={Object.values(this.state.data.geoLevels)}\n\t\t\t\t\t\t\tclassName='geoPicker'\n\t\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t</label>\n\t\t</div>\n\n\t\tconst comparisonPicker = <div className='comparisonPickerWrapper'>\n\t\t<label>\n\t\t\tComparison Variable: \n\t\t\t\t{!!isLoading\n\t\t\t\t? 'loading'\n\t\t\t\t:\t<Select\n\t\t\t\t\t\tvalue={getComparisonVarLabel()}\n\t\t\t\t\t\tonChange={handleComparisonChange}\n\t\t\t\t\t\toptions={Object.values(this.state.data.comparisonVars)}\n\t\t\t\t\t\tclassName='comparisonPicker'\n\t\t\t\t\t/>\n\t\t\t}\n\t\t</label>\n\t\t</div>\n\n    return (\n      <div className=\"App\">\n\t\t\t{!!isLoading\n          ? 'loading'\n          : <div>\n\t\t\t\t\t\t<header className=\"App-header\">\n\t\t\t\t\t\t\t<Grid fluid>\n\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t<Col xs className='col left-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello uptown */}\n\t\t\t\t\t\t\t\t\t\t{regionPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t\t<Col xs className='col center-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello midtown */}\n\t\t\t\t\t\t\t\t\t\t{geoPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t\t<Col xs className='col right-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello downtown  */}\n\t\t\t\t\t\t\t\t\t\t{comparisonPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</header>\n\t\t\t\t\t\t{/* <FiltersComponent/> */}\n\t\t\t\t\t\t<BodyComponent\n\t\t\t\t\t\t\tsmallMultiplesData={this.state.data.dataForSmallMultiples}\n\t\t\t\t\t\t\tscatterPlotData={this.state.data.dataForScatter}\n\t\t\t\t\t\t\tmapData={this.state.data.dataForMap}\n\t\t\t\t\t\t\tallMapSources={this.state.data.allMapSources}\n\t\t\t\t\t\t\t// scatterPlotXVal={this.state.selectedComparison[1].slice(11)}\n\t\t\t\t\t\t\tscatterPlotXVal={this.state.selectedComparison[1]}\n\t\t\t\t\t\t\tscatterPlotXValLabel={getComparisonVarLabel()}\n\t\t\t\t\t\t\tyMinLimit={this.state.yMinLimit}\n\t\t\t\t\t\t\taddFilter={this.addFilter.bind(this)}\n\t\t\t\t\t\t\tyearsRange={this.state.filters.years}\n\t\t\t\t\t\t\tmapFormatting={this.state.data.regions[this.state.selectedRegion]}\n\t\t\t\t\t\t\tmapGeoId={this.state.data.geo[this.state.selectedRegion][this.state.selectedGeoLevel].id}\n\t\t\t\t\t\t\tmapGeoPlaceName={this.state.data.geo[this.state.selectedRegion][this.state.selectedGeoLevel].placeName}\n\t\t\t\t\t\t\tdimensions={this.state.dimensions}\n\t\t\t\t\t\t\tinfoBoxes={this.state.data.infoBoxes}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// import * as d3 from 'd3';\nimport { csv, json } from 'd3-fetch';\nimport sheetsy from 'sheetsy';\n\n\n// import geo_eng_LAD from './data/geo/geo_eng_LAD.json';\n// import geo_eng_ward from './data/geo/geo_eng_ward.json';\n\n// import grants_eng_LAD_ward_donor_year from './data/grants/grants_eng_LAD_ward_donor_year.csv';\n\n// import comparison_eng_LAD_deprivation from './data/comparison/comparison_eng_LAD_deprivation.csv';\n// import comparison_eng_ward_deprivation from './data/comparison/comparison_eng_ward_deprivation.csv';\n// import comparison_eng_LAD_charities from './data/comparison/comparison_eng_LAD_charities.csv';\n// import comparison_eng_ward_charities from './data/comparison/comparison_eng_ward_charities.csv';\n// import comparison_eng_LAD_population from './data/comparison/comparison_eng_LAD_population.csv';\n// import comparison_eng_ward_population from './data/comparison/comparison_eng_ward_population.csv';\n\n\nimport _ from 'lodash';\nimport { DH_CHECK_P_NOT_SAFE_PRIME } from 'constants';\n\n// import geo_eng_LAD from './data/geo/geo_eng_LAD.json';\n// import geo_eng_ward from './data/geo/geo_eng_ward.json';\n\n// import grants_eng_LAD_ward_donor_year from './data/grants/grants_eng_LAD_ward_donor_year.csv';\n\n// import comparison_eng_LAD_deprivation from './data/comparison/comparison_eng_LAD_deprivation.csv';\n// import comparison_eng_ward_deprivation from './data/comparison/comparison_eng_ward_deprivation.csv';\n// import comparison_eng_LAD_charities from './data/comparison/comparison_eng_LAD_charities.csv';\n// import comparison_eng_ward_charities from './data/comparison/comparison_eng_ward_charities.csv';\n// import comparison_eng_LAD_population from './data/comparison/comparison_eng_LAD_population.csv';\n// import comparison_eng_ward_population from './data/comparison/comparison_eng_ward_population.csv';\n\n\n\nexport const loadAllData = (size,currentData) => {\n  console.log(\"Loading Data for size \" + size);\n\n  const { urlToKey, getWorkbook, getSheet } = sheetsy;\n\n  // { name: 'geo_eng_LAD', id: 'LAD2011_CD', placeName: 'lad11nm', data: 'geo_eng_LAD', year: '2011', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/geo/geo_eng_LAD_topo.json'},\n  // { name: 'geo_eng_ward', id: 'wd17cd', placeName: 'wd17nm', data: 'geo_eng_ward', year: '2017', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/geo/geo_eng_ward_topo.json'},\n    \n\n  const filesSmall = [\n    // { name: 'geo_eng_LAD', id: 'LAD2011_CD', placeName: 'lad11nm', data: 'geo_eng_LAD', year: '2011', type: 'geojson', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/geo/geo_eng_LAD.json'},\n    { name: 'geo_eng_LAD', id: 'LAD2011_CD', placeName: 'lad11nm', data: 'geo_eng_LAD', year: '2011', type: 'vector', sourceLayer: 'geo_eng_LAD', filePath: 'mapbox://yannaungoak.0ge46srg', lookupFilePath: 'https://360-giving-grants-map.s3.eu-west-2.amazonaws.com/data/geo/geo_eng_LAD_lookup.json'},\n    // { name: 'geo_eng_ward', id: 'wd17cd', placeName: 'wd17nm', data: 'geo_eng_ward', year: '2017', type: 'geojson', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/geo/geo_eng_ward.json'},\n    { name: 'geo_eng_ward', id: 'wd17cd', placeName: 'wd17nm', data: 'geo_eng_ward', year: '2017', type: 'vector', sourceLayer: 'geo_eng_ward', filePath: 'mapbox://yannaungoak.c4hq3m9h', lookupFilePath: 'https://360-giving-grants-map.s3.eu-west-2.amazonaws.com/data/geo/geo_eng_ward_lookup.json'},\n    {  \n      name: 'grants_eng_LAD_ward_donor_year', \n      data: 'grants_eng_LAD_ward_donor_year',\n      id: {\n        'LAD': 'Recipient District Geographic Code',\n        'ward': 'Recipient Ward Geographic Code'\n      },\n      dataField: 'Amount Awarded', \n      filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/grants/grants_eng_LAD_ward_donor_year.csv'\n    },\n    { name: 'comparison_eng_LAD_deprivation', id: 'LAD2013_CD', data: 'comparison_eng_LAD_deprivation', year: '2015', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_LAD_deprivation.csv'},\n    { name: 'comparison_eng_ward_deprivation', id: 'WD17CD', data: 'comparison_eng_ward_deprivation', year: '2015', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_ward_deprivation.csv'},\n    { name: 'comparison_eng_LAD_charities', id: 'lad11cd', data: 'comparison_eng_LAD_charities', year: '2018', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_LAD_charities.csv'},\n    { name: 'comparison_eng_ward_charities', id: 'WD17CD', data: 'comparison_eng_ward_charities', year: '2018', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_ward_charities.csv'},\n    { name: 'comparison_eng_LAD_population', id: 'lad11cd', data: 'comparison_eng_LAD_population', year: '2017', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_LAD_population.csv'},\n    { name: 'comparison_eng_ward_population', id: 'Ward Code 1', data: 'comparison_eng_ward_population', year: '2017', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/comparison/comparison_eng_ward_population.csv'},\n    // { name: 'infoboxesGoogleSheet', filePath: 'https://docs.google.com/spreadsheets/d/1b94FIknCydzUCC1o5pceMGYgG2pjfowMTOfAbJs4l-Q/edit?usp=sharing'}\n    { name: 'infoboxesGoogleSheet', csvPath: 'https://docs.google.com/spreadsheets/d/1b94FIknCydzUCC1o5pceMGYgG2pjfowMTOfAbJs4l-Q/export?gid=0&format=csv', filePath: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQCz2QeRc4QGYCU7pdnsT2G1bL8PpUK9cdadRpw_e5gAD0ys-lS1w_P3EQkTr2HL6CfwGatd_8P86G5/pubhtml'}\n  ]\n\n  // const filesLarge = [\n  //   { name: 'geo_eng_ward', id: 'wd17cd', placeName: 'wd17nm', data: 'geo_eng_ward', year: '2017', filePath: 'https://s3.eu-west-2.amazonaws.com/360-giving-grants-map/data/geo/geo_eng_ward.json'},\n  // ]\n\n  const files = filesSmall;\n\n  const abbreviations = {\n    geoLevel: {\n      'LAD': 'Local Authority District',\n      'ward': 'Ward'\n    },\n    region: {\n      'eng': 'England',\n      'sco': 'Scotland',\n      'nir': 'Northern Ireland',\n      'wal': 'Wales',\n      'uk': 'United Kingdom'\n    }\n  }\n\n  const regions = {\n    eng: { value: 'eng', label: 'England', position: [-1.464854, 52.561928], zoom: 5 }\n  }\n\n  const geoLevels = {\n    LAD: { value: 'LAD', label: 'Local Authority District'},\n    ward: { value: 'ward', label: 'Ward'}\n  }\n\n\n\n  const promises = [];\n\n  files.forEach((f) => {\n    if (f.filePath.slice(-4) === '.csv') {\n      promises.push( csv(f.filePath) );\n    } else if (f.filePath.slice(-5) === '.json') {\n      promises.push( json(f.filePath) );\n    } else if (f.name === 'infoboxesGoogleSheet' ) {\n      promises.push(\n        csv(f.csvPath)\n        // getWorkbook(urlToKey(f.filePath))\n        // getWorkbook(urlToKey(f.filePath))\n        // .then(workBook => {\n        //   console.log(workBook);\n        //   return getSheet(\n        //     urlToKey(f.filePath),\n        //     workBook.sheets[0].id\n        //   )\n        // })\n      )\n    } else {\n      promises.push(json(f.lookupFilePath));\n    }\n\n    \n  });\n\n\n  return Promise.all(promises).then(function(values) {\n\n    let result = {\n      geo: {eng: {LAD: {}, ward: {}}}, \n      comparison: {eng: {LAD: {}, ward: {}}},\n      grant: {eng: {}}, \n      abbreviations: abbreviations,\n      regions: regions,\n      geoLevels: geoLevels,\n      allMapSources: []\n    };\n\n    if (currentData) result = currentData;\n\n\n    console.log(result);\n    console.log(values);\n\n    for (let i = 0; i < files.length; i++) {\n       const [category, country, geoLevel, ...otherParts] = files[i].name.split('_');\n       const datasetName = category === 'grants' \n        ? [geoLevel, ...otherParts].join('_')\n        : otherParts.join('_');\n\n       switch (category) {\n         case 'geo': { \n           result.geo[country][geoLevel] = {\n             'sourceName': files[i].name,\n             'id': files[i].id, \n             'placeName': files[i].placeName,\n             'year': files[i].year,\n             'type': files[i].type,\n             'data': files[i].type === 'geojson' ? values[i] : [],\n             'sourceLayer': files[i].type === 'geojson' ? '' : files[i].sourceLayer,\n             'filePath': files[i].filePath,\n             'lookUp': files[i].type === 'geojson' \n                ? _.keyBy(\n                    values[i].features\n                    // values[i].objects[files[i].name].geometries // this is for TopoJSON\n                      .map(f => {\n                        return({'key': f.properties[files[i].id],'value': f.properties[files[i].placeName]}) \n                      }), \n                  'key'\n                )\n                : values[i]\n            };\n            result.geoLevels[geoLevel].label = result.geoLevels[geoLevel].label + ' (' + files[i].year + \")\"\n           break; \n          }\n        case 'grants': { \n          result.grant[country][datasetName] = {\n            'id': files[i].id, \n            'data': values[i],\n            'dataField': files[i].dataField\n          };\n          break; \n         }\n        case 'comparison': { \n          result.comparison[country][geoLevel][datasetName] = {\n            'id': files[i].id, \n            'year': files[i].year,\n            'data': values[i]\n          };\n          break; \n         }\n        \n        case 'infoboxesGoogleSheet': { \n          result.infoBoxes = _.keyBy(values[i].map(d=> ({id:d.id,content:d.content})), 'id');\n          break; \n         }\n         default: break;\n       }\n    }\n    _.forEach(result.geo, function(valueRegion, keyRegion) {\n      _.forEach(valueRegion, function(valueLevel, keyLevel) {\n        result.allMapSources.push(valueLevel)\n      })\n    });\n\n    return result;\n  });\n\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}